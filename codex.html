<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="max-age=604800, public">
    <title>Liste d'objets</title>
    <link rel="icon" type="image/x-icon" href="assets/images/ALICE_ACADEMIA.ico">
    <link rel="stylesheet" href="css/style.css?v=1770112863">
    <link rel="stylesheet" href="css/codex.css?v=1770112863">
    <link rel="stylesheet" href="css/cropper-controls.css?v=202602032">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3.10.0/notyf.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css">
    <!-- Preload handled dynamically once data.js is available -->
</head>
<body class="min-h-screen">
    <main class="wrapper codex-shell" aria-labelledby="pageTitle">
        <header class="page-header">
            <a href="inventaire.html" class="page-back" title="Retour √† l'inventaire">‚Üê Retour</a>
            <div class="page-header-main">
                <div class="page-title-block">
                    <h1 class="page-title" id="pageTitle">Codex d'Astoria</h1>
                    <p class="codex-subtitle">Atlas des objets, bonus et effets de jeu.</p>
                </div>
                <div class="character-summary" aria-label="R√©sum√© du personnage">
                    <div class="character-avatar-wrapper">
                        <div class="character-avatar character-avatar--clickable" role="button" tabindex="0" aria-haspopup="true" aria-label="Changer de personnage">
                            <img class="character-avatar-img" id="characterSummaryAvatar" alt="Avatar" hidden>
                            <div class="character-avatar-circle" id="characterSummaryInitial" hidden></div>
                        </div>
                        <div class="character-dropdown" hidden aria-label="S√©lectionner un personnage"></div>
                    </div>
                    <div class="character-summary-text">
                        <a class="character-name" id="characterSummaryName" href="profil.html">Nom du personnage</a>
                        <span class="character-tagline" id="characterSummaryTagline">Classe / Role / Surnom</span>
                        <div class="character-summary-meta">
                            <span class="stats-badge" id="characterKaelsBadge" hidden>0 kaels</span>
                            <div class="character-souls" id="characterSouls" hidden>
                                <span class="soul-count" title="√Çmes consommation"><span class="soul-icon">üî•</span><span id="soulConsoValue">0</span></span>
                                <span class="soul-count" title="√Çmes progression"><span class="soul-icon">‚≠ê</span><span id="soulProgValue">0</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="codex-control-panel" aria-label="Filtres du codex">
            <div class="codex-toolbar">
                <span class="stats-badge" id="statsBadge">0 objet</span>
                <button type="button" class="admin-add-btn tw-press" id="adminAddItemBtn" hidden>+ Ajouter un objet</button>
                <div class="codex-toolbar-spacer"></div>
                <div class="inventory-search" id="codexSearch" data-search-priority="page">
                    <button type="button" class="inventory-search-toggle tw-press" id="codexSearchToggle" aria-label="Rechercher" aria-expanded="false">
                        <span class="inventory-search-icon">&#x1F50D;</span>
                    </button>
                    <input
                        type="search"
                        id="searchInput"
                        class="inventory-search-input tw-input"
                        placeholder="Rechercher un objet..."
                        aria-label="Rechercher un objet">
                    <div class="recent-searches-dropdown inventory-search-history" id="recentSearchesDropdown"></div>
                </div>
            </div>
            <!-- Category Pills -->
            <nav class="codex-category-pills" id="categoryPills" aria-label="Filtrer par cat√©gorie">
                <button type="button" class="codex-category-pill active" data-category="">
                    <span class="pill-icon">&#x1F4E6;</span>
                    <span>Tous</span>
                    <span class="pill-count" id="countAll">0</span>
                </button>
                <button type="button" class="codex-category-pill" data-category="agricole">
                    <span class="pill-icon">&#x1F33E;</span>
                    <span>Agricole</span>
                    <span class="pill-count" id="countAgricole">0</span>
                </button>
                <button type="button" class="codex-category-pill" data-category="consommable">
                    <span class="pill-icon">&#x1F9EA;</span>
                    <span>Consommables</span>
                    <span class="pill-count" id="countConsommable">0</span>
                </button>
                <button type="button" class="codex-category-pill" data-category="equipement">
                    <span class="pill-icon">&#x2694;&#xFE0F;</span>
                    <span>√âquipements</span>
                    <span class="pill-count" id="countEquipement">0</span>
                </button>
                <button type="button" class="codex-category-pill" data-category="materiau">
                    <span class="pill-icon">&#x2692;&#xFE0F;</span>
                    <span>Mat√©riaux</span>
                    <span class="pill-count" id="countMateriau">0</span>
                </button>
                <button type="button" class="codex-category-pill" data-category="quete">
                    <span class="pill-icon">&#x2728;</span>
                    <span>Qu√™tes</span>
                    <span class="pill-count" id="countQuete">0</span>
                </button>
            </nav>
            <!-- Hidden dropdown for backwards compatibility -->
            <select id="categoryFilter" class="category-dropdown tw-input" hidden>
                <option value="">Toutes cat√©gories</option>
                <option value="agricole">Agricole</option>
                <option value="consommable">Consommables</option>
                <option value="equipement">√âquipements</option>
                <option value="materiau">Mat√©riaux</option>
                <option value="quete">Qu√™tes</option>
            </select>
        </section>
        <div class="table-container tw-panel">
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th scope="col">Illustration</th>
                        <th scope="col" class="sortable name-column" aria-sort="none" data-sort="name">Nom <span class="sort-indicator"></span></th>
                        <th scope="col">Description</th>
                        <th scope="col" class="sortable" aria-sort="none" data-sort="price">Commerce <span class="sort-indicator"></span></th>
                        <th scope="col">Effets &amp; bonus</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </main>
    <!-- Modal pour voir un item en grand / d√©tails -->
    <div
        id="itemModal"
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalName"
        aria-describedby="modalDescription"
    >
        <div class="modal-inner">
            <div class="modal-header">
                <h2 class="modal-title" id="modalName"></h2>
                <div class="modal-admin-actions" id="modalAdminActions" hidden>
                    <button type="button" class="admin-edit-btn tw-press" id="adminEditBtn">Modifier</button>
                </div>
                <button class="modal-close tw-press" aria-label="Fermer la fen√™tre">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-media">
                    <div class="modal-carousel" id="modalCarousel">
                        <button class="carousel-btn prev tw-press" id="carouselPrev" aria-label="Image pr√©c√©dente">‚Äπ</button>
                        <img id="modalImage" alt="">
                        <button class="carousel-btn next tw-press" id="carouselNext" aria-label="Image suivante">‚Ä∫</button>
                    </div>
                    <div class="carousel-dots" id="carouselDots"></div>
                </div>
                <div class="modal-text">
                    <p id="modalCategory"></p>
                    <p id="modalDescription"></p>
                    <p id="modalPrice"></p>
                    <p id="modalModifiers"></p>
                    <p id="modalEffect"></p>
                </div>
            </div>
        </div>
    </div>
    <div class="codex-admin-backdrop" id="adminItemBackdrop" aria-hidden="true">
        <div class="codex-admin-modal" role="dialog" aria-modal="true" aria-labelledby="adminItemTitle">
            <div class="codex-admin-header">
                <h2 class="codex-admin-title" id="adminItemTitle">Ajouter un objet</h2>
                <button type="button" class="codex-admin-close tw-press" id="adminItemClose" aria-label="Fermer">x</button>
            </div>
            <div class="codex-admin-error" id="adminItemError" role="alert"></div>
            <div class="codex-admin-note" id="adminItemNote"></div>
            <form id="adminItemForm">
                <div class="codex-admin-section">
                    <div class="codex-admin-section-title">Infos</div>
                    <div class="codex-admin-grid">
                        <div class="codex-admin-field">
                            <label class="codex-admin-label" for="adminItemName">Nom</label>
                            <input class="codex-admin-input tw-input" id="adminItemName" name="name" required>
                        </div>
                        <div class="codex-admin-field">
                            <label class="codex-admin-label" for="adminItemCategory">Categorie</label>
                            <select class="codex-admin-input tw-input" id="adminItemCategory" name="category">
                                <option value="">Choisir une categorie</option>
                            </select>
                        </div>
                        <div class="codex-admin-field" id="adminItemEquipmentSlotField" style="display: none;">
                            <label class="codex-admin-label" for="adminItemEquipmentSlot">Emplacement d'&#233;quipement</label>
                            <select class="codex-admin-input tw-input" id="adminItemEquipmentSlot" name="equipmentSlot">
                                <option value="">Non sp&#233;cifi&#233;</option>
                                <option value="casque">Casque</option>
                                <option value="cape">Cape</option>
                                <option value="epaulettes">&#201;paulettes</option>
                                <option value="collier">Collier</option>
                                <option value="plastron">Plastron</option>
                                <option value="ceinture">Ceinture</option>
                                <option value="gantelets">Gantelets</option>
                                <option value="anneau">Anneau</option>
                                <option value="bottes">Bottes</option>
                                <option value="arme">Arme</option>
                                <option value="arme-deux-mains">Arme &#224; deux mains</option>
                                <option value="artefact">Artefact</option>
                                <option value="familier">Familier</option>
                                <option value="monture">Monture</option>
                            </select>
                        </div>
                        <div class="codex-admin-field">
                            <label class="codex-admin-label" for="adminItemBuy">Prix achat</label>
                            <input class="codex-admin-input tw-input" id="adminItemBuy" name="buy" placeholder="ex: 5 po">
                        </div>
                        <div class="codex-admin-field">
                            <label class="codex-admin-label" for="adminItemSell">Prix vente</label>
                            <input class="codex-admin-input tw-input" id="adminItemSell" name="sell" placeholder="ex: 2 po">
                        </div>
                    </div>
                </div>
                <div class="codex-admin-section">
                    <div class="codex-admin-section-title">Description</div>
                    <textarea class="codex-admin-textarea tw-input" id="adminItemDescription" name="description" rows="3" placeholder="Description courte..."></textarea>
                </div>
                <div class="codex-admin-section">
                    <div class="codex-admin-section-title">Effet</div>
                    <textarea class="codex-admin-textarea tw-input" id="adminItemEffect" name="effect" rows="2" placeholder="Effet principal..."></textarea>
                </div>
                <div class="codex-admin-section">
                    <div class="codex-admin-section-title">Image</div>
                    <div class="codex-admin-image">
                        <div class="codex-admin-image-preview" id="adminItemImagePreview">
                            <span class="codex-admin-image-placeholder">Image</span>
                            <img id="adminItemImage" alt="Apercu image" hidden>
                        </div>
                        <div class="codex-admin-image-actions">
                            <button type="button" class="codex-admin-button secondary tw-press" id="adminItemImageBtn">Importer l'image</button>
                            <span class="codex-admin-image-hint">Recadre en carre pour garder la taille.</span>
                        </div>
                        <div class="codex-admin-image-meta" id="adminItemImageMeta">Aucun fichier</div>
                        <input type="file" id="adminItemImageInput" accept="image/*" hidden>
                    </div>
                </div>
                <div class="codex-admin-actions">
                    <button type="button" class="codex-admin-button danger tw-press" id="adminItemDelete" hidden>üóëÔ∏è Supprimer</button>
                    <div class="codex-admin-actions-group">
                        <button type="button" class="codex-admin-button secondary tw-press" id="adminItemCancel">Annuler</button>
                        <button type="submit" class="codex-admin-button tw-press" id="adminItemSave">Enregistrer</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="codex-cropper-backdrop" id="itemCropperBackdrop" aria-hidden="true">
        <div class="codex-cropper-modal" role="dialog" aria-modal="true" aria-labelledby="itemCropperTitle">
            <div class="codex-cropper-header">
                <h2 class="codex-cropper-title" id="itemCropperTitle">Recadrer l'image</h2>
                <button type="button" class="codex-cropper-close tw-press" id="itemCropperClose" aria-label="Fermer">x</button>
            </div>
            <div class="codex-cropper-body">
                <div class="codex-cropper-stage">
                    <img id="itemCropperImage" alt="Apercu recadrage">
                </div>
                <div class="codex-cropper-controls">
                    <!-- Aspect Ratio Controls -->
                    <div class="cropper-control-group">
                        <label>Format</label>
                        <div class="cropper-button-group">
                            <button type="button" class="cropper-btn cropper-aspect-btn active" data-ratio="1" title="Carr√© 1:1">‚ñ° Carr√©</button>
                            <button type="button" class="cropper-btn cropper-aspect-btn" data-ratio="1.7778" title="Paysage 16:9">‚ñ≠ Paysage</button>
                            <button type="button" class="cropper-btn cropper-aspect-btn" data-ratio="0.5625" title="Portrait 9:16">‚ñØ Portrait</button>
                        </div>
                    </div>

                    <!-- Rotation Controls -->
                    <div class="cropper-control-group">
                        <label>Rotation</label>
                        <div class="cropper-button-group">
                            <button type="button" class="cropper-btn tw-press" id="itemCropperRotateLeft" title="Rotation -90¬∞">‚Ü∫ -90¬∞</button>
                            <button type="button" class="cropper-btn tw-press" id="itemCropperRotateRight" title="Rotation +90¬∞">‚Üª +90¬∞</button>
                            <button type="button" class="cropper-btn tw-press" id="itemCropperRotate180" title="Rotation 180¬∞">‚Üª 180¬∞</button>
                        </div>
                    </div>

                    <!-- Flip Controls -->
                    <div class="cropper-control-group">
                        <label>Miroir</label>
                        <div class="cropper-button-group">
                            <button type="button" class="cropper-btn tw-press" id="itemCropperFlipX" title="Miroir horizontal">‚Üî Horizontal</button>
                            <button type="button" class="cropper-btn tw-press" id="itemCropperFlipY" title="Miroir vertical">‚Üï Vertical</button>
                        </div>
                    </div>

                    <!-- Zoom Controls -->
                    <div class="cropper-control-group">
                        <label for="itemCropperZoom">Zoom</label>
                        <div class="cropper-zoom-group">
                            <button type="button" class="cropper-btn tw-press" id="itemCropperZoomOut" title="Zoom -">‚àí</button>
                            <input type="range" id="itemCropperZoom" min="0.2" max="3" step="0.01" value="1">
                            <button type="button" class="cropper-btn tw-press" id="itemCropperZoomIn" title="Zoom +">+</button>
                        </div>
                    </div>

                    <!-- Reset Button -->
                    <div class="cropper-control-group">
                        <button type="button" class="cropper-btn cropper-btn-secondary tw-press" id="itemCropperReset" title="R√©initialiser">‚Ü∫ R√©initialiser</button>
                    </div>

                    <span class="codex-cropper-hint">Utilise les contr√¥les pour ajuster le cadrage.</span>
                </div>
            </div>
            <div class="codex-cropper-actions">
                <button type="button" class="codex-admin-button secondary tw-press" id="itemCropperCancel">Annuler</button>
                <button type="button" class="codex-admin-button tw-press" id="itemCropperConfirm">Appliquer</button>
            </div>
        </div>
    </div>
    <!-- Delete confirmation modal -->
    <div class="codex-delete-backdrop" id="deleteItemBackdrop" aria-hidden="true">
        <div class="codex-delete-modal" role="dialog" aria-modal="true" aria-labelledby="deleteItemTitle">
            <div class="codex-delete-header">
                <h2 class="codex-delete-title" id="deleteItemTitle">Supprimer l'objet</h2>
            </div>
            <div class="codex-delete-body">
                <p>Voulez-vous vraiment supprimer <strong id="deleteItemName"></strong> ?</p>
                <p class="codex-delete-warning">Cette action est irr√©versible.</p>
            </div>
            <div class="codex-delete-actions">
                <button type="button" class="codex-admin-button secondary tw-press" id="deleteItemCancel">Annuler</button>
                <button type="button" class="codex-admin-button danger tw-press" id="deleteItemConfirm">Supprimer</button>
            </div>
        </div>
    </div>
    <!-- Donn√©es des objets -->
    <script src="js/image-helpers.js"></script>
    <script src="js/data.js"></script>
    <script src="js/item-modifiers.js"></script>
    <!-- External Libraries (CDN) - MUST LOAD FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>

    <!-- Floating UI for tooltips/popovers (~5KB) -->

    <!-- Notyf for toast notifications (~6KB) -->
    <script src="https://cdn.jsdelivr.net/npm/notyf@3.10.0/notyf.min.js"></script>

    <!-- body-scroll-lock for modal scroll prevention (~2KB) -->
    <script src="https://cdn.jsdelivr.net/npm/body-scroll-lock@4.0.0-beta.0/lib/bodyScrollLock.min.js"></script>

    <!-- localForage for IndexedDB/localStorage abstraction (~17KB) -->
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>



    <!-- Choices.js for select dropdowns (~18KB) -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>

    <!-- Library Wrappers (Astoria) - MUST LOAD BEFORE APP SCRIPTS -->
    <script src="js/components/toast-manager.js"></script>
    <script src="js/components/storage-manager.js"></script>
    <script src="js/components/modal-manager.js"></script>
    <script src="js/components/uploader-cropper.js"></script>
    <script src="js/utils/sanitize.js"></script>

    <!-- App Scripts (now can use wrappers) -->
    <script src="js/ui/list-helpers.js"></script>
    <script src="js/ui/search-history.js"></script>
    <script src="js/ui/searchbar.js"></script>
    <script src="js/components/type-to-search.js"></script>
    <script type="module" src="js/ui/app-shell.js"></script>
    <script src="js/codex.js?v=1770112863"></script>
    <script type="module" src="js/codex-admin-summary.js?v=1770112863"></script>
    <script type="module" src="js/codex-admin.js?v=1770112863"></script>
    <script src="js/sidebar.js?v=1770112863"></script>
</body>
</html>
