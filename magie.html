<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche Magie | Spécification</title>
    <link rel="icon" type="image/x-icon" href="assets/images/ALICE_ACADEMIA.ico">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/magie.css">
    <script src="js/tailwind-config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/data.js"></script>
    <style type="text/tailwindcss">
        @layer base {
            html { @apply scroll-smooth; }
            body { @apply antialiased; }
            a, button, [role="button"] { @apply transition-colors duration-200 ease-out; }
            input, select, textarea { @apply transition-shadow duration-200 ease-out; }
            a:focus-visible, button:focus-visible, [role="button"]:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible { @apply outline-none ring-2 ring-astoria-400 ring-offset-2 ring-offset-white; }
        }
    
        @layer utilities {
            .ring-astoria-400 {
                --tw-ring-opacity: 1;
                --tw-ring-color: rgb(255 106 162 / var(--tw-ring-opacity));
            }
            .ring-astoria-400\/40 {
                --tw-ring-opacity: 0.4;
                --tw-ring-color: rgb(255 106 162 / var(--tw-ring-opacity));
            }

            .fade-in {
                @apply opacity-0 translate-y-2;
                animation: fadeIn 0.6s ease forwards;
            }
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

                        @layer components {
            .tw-surface { @apply shadow-soft ring-1 ring-black/5; }
            .tw-surface-strong { @apply shadow-soft ring-2 ring-astoria-200/60; }
            .tw-press { @apply transition-transform duration-200 ease-out active:scale-[0.98]; }
            .tw-hover { @apply transition-transform duration-200 ease-out hover:-translate-y-0.5; }
            .tw-panel { @apply rounded-2xl bg-white/80 backdrop-blur-md border border-white/70 shadow-soft; }
            .tw-card { @apply rounded-2xl bg-white/90 border border-astoria-200/60 shadow-soft; }
            .tw-card-hover { @apply transition-transform duration-200 ease-out hover:-translate-y-1; }
            .tw-btn { @apply inline-flex items-center justify-center gap-2 rounded-full px-4 py-2 font-semibold shadow-soft bg-gradient-to-br from-astoria-400 to-astoria-600 text-white; }
            .tw-btn-ghost { @apply rounded-full border border-astoria-200/70 bg-white/80 text-astoria-600; }
            .tw-input { @apply rounded-xl border border-astoria-200/60 bg-white/90 px-4 py-2 text-sm font-semibold text-gray-700 focus:ring-2 focus:ring-astoria-400/40; }
            .tw-pill { @apply inline-flex items-center gap-1 rounded-full bg-white/70 border border-astoria-200/60 px-3 py-1 text-xs font-semibold text-astoria-600; }
            .tw-back { @apply inline-flex items-center gap-2 rounded-full border border-astoria-200/70 bg-white/80 text-astoria-600 px-4 py-2 font-semibold shadow-soft; }
        }
</style>
</head>
<body data-admin="false" class="min-h-screen">
    <main class="magic-page fade-in" aria-labelledby="magicPageTitle">
        <header class="magic-header">
            <a href="index.html" class="magic-back-link tw-back tw-press" title="Retour à l'accueil">&#8592; Retour</a>
            <div class="magic-header-main">
                <div class="magic-title-block">
                    <h1 class="magic-title" id="magicPageTitle">Fiche Magie | Spécification</h1>
                </div>
                <div class="character-summary" aria-label="Resume du personnage">
                    <div class="character-avatar-wrapper">
                        <div class="character-avatar character-avatar--clickable" role="button" tabindex="0" aria-haspopup="true" aria-label="Changer de personnage">
                            <img class="character-avatar-img" id="characterSummaryAvatar" alt="Avatar" hidden>
                            <div class="character-avatar-circle" id="characterSummaryInitial" hidden></div>
                        </div>
                        <div class="character-dropdown" hidden aria-label="Sélectionner un personnage"></div>
                    </div>
                    <div class="character-summary-text">
                        <a class="character-name" id="characterSummaryName" href="profil.html">Nom du personnage</a>
                        <span class="character-tagline" id="characterSummaryTagline">Classe / Role / Surnom</span>
                    </div>
                </div>
            </div>
        </header>
        <section class="magic-layout" aria-label="Fiche magie détaillée">
            <div class="magic-sheet tw-surface tw-panel">
                <div class="magic-page-tabs" id="magicPageTabs" role="tablist" aria-label="Pages de fiche magie">
                    <button type="button" class="magic-page-tab magic-page-tab--add tw-press" id="magicAddPageBtn" aria-label="Ajouter une page">+</button>
                </div>
                <!-- Contenu principal -->
                <section class="magic-content" aria-live="polite">
                    <div class="magic-scroll-meter" id="magicScrollMeter" aria-label="Parchemins disponibles">
                        <span class="magic-scroll-pill">Éveil: <strong id="magicEveilCount">0</strong></span>
                        <span class="magic-scroll-pill">Ascension: <strong id="magicAscensionCount">0</strong></span>
                    </div>
                    <div class="magic-top-nav" aria-label="Sections de la fiche" role="navigation">
                        <button class="magic-nav-btn magic-nav-btn--active tw-press tw-btn-ghost" data-target="magic-summary">
                            Résumé &amp; spécialisation
                        </button>
                        <button class="magic-nav-btn tw-press tw-btn-ghost" data-target="magic-parameters">
                            Paramètres de fonctionnement
                        </button>
                        <button class="magic-nav-btn tw-press tw-btn-ghost" data-target="magic-capacities">
                            Capacités &amp; sorts
                        </button>
                        <button class="magic-nav-btn magic-nav-btn--admin tw-press tw-btn-ghost" data-target="magic-admin">
                            Zone admin
                        </button>
                    </div>
                    <div class="magic-save-row">
                        <span class="magic-save-status" id="magicSaveStatus">Sauvegarde en attente.</span>
                        <button type="button" class="magic-btn magic-btn-primary tw-press tw-btn" id="magicSaveBtn">Sauvegarder</button>
                    </div>
                    <div class="magic-content-body">
                        <!-- 1. Résumé & spécialisation -->
                        <section id="magic-summary" class="magic-section magic-section--active" aria-label="Résumé & spécialisation">
                            <h2 class="magic-section-title">Résumé &amp; spécialisation</h2>
                            <div class="magic-cards-grid magic-cards-grid--two tw-surface tw-hover">
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Magie principale</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicName">Nom de la magie</label>
                                        <input id="magicName" class="magic-input tw-input" type="text" placeholder="Ex : Lame de Résonance Astrale">
                                    </div>
                                    <input id="magicAffinityKey" type="hidden">
                                    <div class="magic-form-row">
                                        <label class="magic-label">Affinité</label>
                                        <div class="magic-affinity-pill" id="magicAffinityDisplay">Non assignée</div>
                                    </div>
                                    <div class="magic-form-row magic-form-row--split">
                                        <div class="magic-form-field">
                                            <label class="magic-label" for="magicSpecialization">Spécialisation</label>
                                            <select id="magicSpecialization" class="magic-input tw-input">
                                                <option value="">Sélectionner...</option>
                                                <option value="meister">Meister Arme</option>
                                                <option value="sorcellerie">Sorcellerie</option>
                                                <option value="alice">Alice (Alice Academy)</option>
                                            </select>
                                        </div>
                                        <div class="magic-form-field">
                                            <label class="magic-label" for="magicSubtypes">Sous-type(s)</label>
                                            <input id="magicSubtypes" class="magic-input tw-input" type="text" placeholder="Ex : élémentaire, mental, soutien...">
                                        </div>
                                    </div>
                                </article>
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Résumé narratif &amp; technique</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicSummaryRp">Résumé RP</label>
                                        <textarea id="magicSummaryRp" class="magic-input tw-input--textarea tw-input" rows="3" placeholder="En 2-3 lignes, décrivez comment la magie se manifeste en jeu."></textarea>
                                    </div>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicSummaryTech">Résumé technique</label>
                                        <textarea id="magicSummaryTech" class="magic-input tw-input--textarea tw-input" rows="3" placeholder="Portée globale, nature, style d'utilisation, contraintes générales..."></textarea>
                                    </div>
                                </article>
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Magies enregistrees</h3>
                                    <div class="magic-pages-overview" id="magicPagesOverview"></div>
                                    <p class="magic-overview-hint">Clique pour ouvrir une page.</p>
                                </article>
                            </div>
                        </section>
                        <!-- 2. Paramètres de fonctionnement -->
                        <section id="magic-parameters" class="magic-section" aria-label="Paramètres de fonctionnement de la magie">
                            <h2 class="magic-section-title">Paramètres de fonctionnement</h2>
                            <div class="magic-cards-grid magic-cards-grid--three tw-surface tw-hover">
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Origine &amp; portée</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicSource">Source de magie</label>
                                        <input id="magicSource" class="magic-input tw-input" type="text" placeholder="Mana, pacte, émotions, artefact...">
                                    </div>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicRange">Portée</label>
                                        <select id="magicRange" class="magic-input tw-input">
                                            <option value="">Sélectionner...</option>
                                            <option value="melee">Corps-à-corps</option>
                                            <option value="short">Courte portée</option>
                                            <option value="medium">Portée moyenne</option>
                                            <option value="long">Longue portée</option>
                                        </select>
                                    </div>
                                </article>
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Effet &amp; coût</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicEffectType">Type d'effet principal</label>
                                        <input id="magicEffectType" class="magic-input tw-input" type="text" placeholder="Dégâts, soin, contrôle, utilitaire...">
                                    </div>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicGlobalCost">Coût global</label>
                                        <textarea id="magicGlobalCost" class="magic-input tw-input--textarea tw-input" rows="2" placeholder="Fatigue, mana, nombre d'utilisations par scène, etc."></textarea>
                                    </div>
                                </article>
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Conditions &amp; faiblesses</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicActivation">Conditions d'activation</label>
                                        <textarea id="magicActivation" class="magic-input tw-input--textarea tw-input" rows="2" placeholder="Contact, incantation, geste, émotion, pacte..."></textarea>
                                    </div>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicWeaknesses">Faiblesses générales</label>
                                        <textarea id="magicWeaknesses" class="magic-input tw-input--textarea tw-input" rows="2" placeholder="Contres, limitations, situations de désavantage."></textarea>
                                    </div>
                                </article>
                            </div>
                        </section>
                        <!-- 3. Capacités / sorts -->
                        <section id="magic-capacities" class="magic-section" aria-label="Capacités et sorts">
                            <div class="magic-section-header">
                                <div>
                                    <h2 class="magic-section-title">Capacités &amp; sorts</h2>
                                    <p class="magic-section-help">
                                        Listez ici chaque technique : nom, type, rang, effet RP et technique, coût, limites.
                                    </p>
                                </div>
                                <div class="magic-section-actions">
                                    <select id="magicCapacityFilter" class="magic-input tw-input--sm tw-input" aria-label="Filtrer les capacités">
                                        <option value="">Toutes les catégories</option>
                                        <option value="offensif">Offensif</option>
                                        <option value="defensif">Défensif</option>
                                        <option value="soutien">Soutien</option>
                                        <option value="utilitaire">Utilitaire</option>
                                    </select>
                                    <button type="button" class="magic-btn magic-btn-primary tw-press tw-btn" id="magicAddCapacityBtn">
                                        + Ajouter une capacité
                                    </button>
                                </div>
                            </div>
                            <div class="magic-capacity-form" id="magicCapacityForm" hidden>
                                <div class="magic-form-row">
                                    <label class="magic-label" for="magicNewCapName">Nom de la capacite</label>
                                    <input id="magicNewCapName" class="magic-input tw-input" type="text" placeholder="Ex : Lame eclipse" />
                                </div>
                                <div class="magic-form-row magic-form-row--split">
                                    <div class="magic-form-field">
                                        <label class="magic-label" for="magicNewCapType">Type</label>
                                        <select id="magicNewCapType" class="magic-input tw-input">
                                            <option value="offensif">Offensif</option>
                                            <option value="defensif">Defensif</option>
                                            <option value="soutien">Soutien</option>
                                            <option value="utilitaire">Utilitaire</option>
                                        </select>
                                    </div>
                                    <div class="magic-form-field">
                                        <label class="magic-label" for="magicNewCapRank">Rang</label>
                                        <select id="magicNewCapRank" class="magic-input tw-input">
                                            <option value="mineur">Mineur</option>
                                            <option value="signature">Signature</option>
                                            <option value="ultime">Ultime</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="magic-form-row">
                                    <label class="magic-label" for="magicNewCapRp">Description RP</label>
                                    <textarea id="magicNewCapRp" class="magic-input tw-input--textarea tw-input" rows="2" placeholder="Declenchement, ambiance, etc."></textarea>
                                </div>
                                <div class="magic-form-row">
                                    <label class="magic-label" for="magicNewCapEffect">Effet mecanique</label>
                                    <textarea id="magicNewCapEffect" class="magic-input tw-input--textarea tw-input" rows="2" placeholder="Degats, effets, duree..."></textarea>
                                </div>
                                <div class="magic-form-row magic-form-row--split">
                                    <div class="magic-form-field">
                                        <label class="magic-label" for="magicNewCapCost">Cout</label>
                                        <input id="magicNewCapCost" class="magic-input tw-input" type="text" placeholder="Mana, fatigue..." />
                                    </div>
                                    <div class="magic-form-field">
                                        <label class="magic-label" for="magicNewCapLimits">Limites</label>
                                        <input id="magicNewCapLimits" class="magic-input tw-input" type="text" placeholder="Conditions, contraintes..." />
                                    </div>
                                </div>
                                <div class="magic-capacity-form-actions">
                                    <button type="button" class="magic-btn magic-btn-outline tw-press tw-btn-ghost" id="magicCapacityCancel">Annuler</button>
                                    <button type="button" class="magic-btn magic-btn-primary tw-press tw-btn" id="magicCapacitySave">Ajouter</button>
                                </div>
                            </div>
                            <ul class="magic-capacity-list" id="magicCapacityList" aria-label="Liste des capacités">
                                <!-- Capacités exemple : purement placeholders -->
                            </ul>
                        </section>
                        <!-- 5. Zone admin -->
                        <section id="magic-admin" class="magic-section magic-section--admin" aria-label="Zone d'administration" hidden>
                            <div class="magic-section-header">
                                <div>
                                    <h2 class="magic-section-title">Zone admin</h2>
                                    <p class="magic-section-help">
                                        Outils de validation et de suivi des fiches magie. Visible uniquement pour les comptes admin.
                                    </p>
                                </div>
                            </div>
                            <div class="magic-cards-grid magic-cards-grid--two tw-surface tw-hover">
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Statut de la fiche</h3>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicSheetStatus">Statut</label>
                                        <select id="magicSheetStatus" class="magic-input tw-input">
                                            <option value="draft">Brouillon</option>
                                            <option value="pending">En attente de validation</option>
                                            <option value="approved">Validée</option>
                                            <option value="changes">À corriger</option>
                                        </select>
                                    </div>
                                    <div class="magic-admin-status-badges">
                                        <span class="magic-status-pill magic-status-pill--draft">Brouillon</span>
                                        <span class="magic-status-pill magic-status-pill--pending">En attente</span>
                                        <span class="magic-status-pill magic-status-pill--approved">Validée</span>
                                        <span class="magic-status-pill magic-status-pill--changes">À corriger</span>
                                    </div>
                                </article>
                                <article class="magic-card tw-surface tw-hover">
                                    <h3 class="magic-card-title">Actions admin</h3>
                                    <div class="magic-admin-actions">
                                        <button type="button" class="magic-btn magic-btn-outline tw-press tw-btn-ghost">Valider</button>
                                        <button type="button" class="magic-btn magic-btn-outline tw-press tw-btn-ghost">Demander des corrections</button>
                                        <button type="button" class="magic-btn magic-btn-outline tw-press tw-btn-ghost">Ajouter une note interne</button>
                                    </div>
                                    <div class="magic-form-row">
                                        <label class="magic-label" for="magicAdminNotes">Note interne</label>
                                        <textarea id="magicAdminNotes" class="magic-input tw-input--textarea tw-input" rows="3" placeholder="Commentaires MJ / staff, remarques d'équilibrage, suivi des modifications."></textarea>
                                    </div>
                                </article>
                            </div>
                        </section>
                    </div>
                </section>
            </div>
        </section>
    </main>
    <script type="module" src="js/ui/app-shell.js"></script>
    <script src="js/magie.js" defer></script>
    <script src="js/sidebar.js"></script>
</body>
</html>
